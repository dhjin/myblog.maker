

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Multi Layer Perceltron - dhjin</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="dhjin">
<meta property="og:title" content="Multi Layer Perceltron">


  <link rel="canonical" href="http://localhost:4000/mlp_tutorial_in_julia/">
  <meta property="og:url" content="http://localhost:4000/mlp_tutorial_in_julia/">



  <meta property="og:description" content="출처: https://github.com/FluxML/model-zoo/blob/master/vision/mnist/mlp.jl">



  <meta name="twitter:site" content="@2string.dh">
  <meta name="twitter:title" content="Multi Layer Perceltron">
  <meta name="twitter:description" content="출처: https://github.com/FluxML/model-zoo/blob/master/vision/mnist/mlp.jl">
  <meta name="twitter:url" content="http://localhost:4000/mlp_tutorial_in_julia/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2020-10-04T00:00:00-07:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "dhjin",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="dhjin Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:4000/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="http://localhost:4000/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="http://localhost:4000/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="http://localhost:4000/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="http://localhost:4000/assets/css/academicons.css"/>
<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">dhjin</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/blog/">Blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/publications/">Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/cv/">CV</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/tutorials/">Tutorials</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/0.jpeg" class="author__avatar" alt="dhjin">
    
  </div>

  <div class="author__content">
    <h3 class="author__name"><a href="/">dhjin</a></h3>
    <p class="author__bio">data science @ Computational Linguistics, Korean Linguist.</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
      
      
      
      
        <li><a href="https://twitter.com/2string.dh"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="https://github.com/dhjin"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        <li><a href=""><i class="ai ai-google-scholar-square ai-fw"></i> Google Scholar</a></li>
      
      
        <li><a href="https://www.linkedin.com/in/dhjin"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
        <li><a href="mailto:artofstring@gmail.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      

    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Multi Layer Perceltron">
    <meta itemprop="description" content="출처: https://github.com/FluxML/model-zoo/blob/master/vision/mnist/mlp.jl">
    <meta itemprop="datePublished" content="October 04, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Multi Layer Perceltron
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  6 minute read
	
</p>
          
        
        
        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2020-10-04T00:00:00-07:00">October 04, 2020</time></p>
        
        
             
        
    
        </header>
      

      <section class="page__content" itemprop="text">
        <p>출처: https://github.com/FluxML/model-zoo/blob/master/vision/mnist/mlp.jl</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="n">Flux</span><span class="x">,</span><span class="n">Plots</span>
<span class="k">using</span> <span class="n">Flux</span><span class="o">.</span><span class="n">Data</span><span class="o">:</span> <span class="n">DataLoader</span>
<span class="k">using</span> <span class="n">Flux</span><span class="o">:</span> <span class="n">onehotbatch</span><span class="x">,</span> <span class="n">onecold</span><span class="x">,</span> <span class="n">logitcrossentropy</span><span class="x">,</span> <span class="n">throttle</span><span class="x">,</span> <span class="nd">@epochs</span>
<span class="k">using</span> <span class="n">Base</span><span class="o">.</span><span class="n">Iterators</span><span class="o">:</span> <span class="n">repeated</span>
<span class="k">using</span> <span class="n">Parameters</span><span class="o">:</span> <span class="nd">@with_kw</span>
<span class="k">using</span> <span class="n">MLDatasets</span>
<span class="k">using</span> <span class="n">CUDAapi</span>
</code></pre></div></div>

<h3 id="flux-패키지-및-함수">Flux 패키지 및 함수</h3>
<ul>
  <li>Flux.Data 에서 DataLoader: 데이로 입출력을 관할</li>
  <li>onehotbatch: 정수를 원핫벡터로 변환</li>
  <li>onecold: 0-1 반전.</li>
  <li>MLDatasets: 머신러닝을 위한 오픈소스 데이터세트</li>
  <li>CUDAapi: GPU 사용을 위한 패키지</li>
</ul>

<h2 id="1-cuda-세팅">[1] CUDA 세팅</h2>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">has_cuda</span><span class="x">()</span> <span class="c"># CUDA 패키지를 활용 GPU 사용 여부를 감지한다.</span>
    <span class="nd">@info</span> <span class="s">"CUDA is on"</span>
    <span class="k">import</span> <span class="n">CuArrays</span> <span class="c"># 가능하다면 CuArrays를 import해 온다.</span>
    <span class="n">CuArrays</span><span class="o">.</span><span class="n">allowscalar</span><span class="x">(</span><span class="nb">false</span><span class="x">)</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="2-파라미터-세팅">[2] 파라미터 세팅</h2>
<ul>
  <li>@with_kw를 사용, 파라미터 값들을 Args 변수에 할당함.</li>
  <li>mutable struct Args: “Args”라는 새로운 자료유형 설정, 안의 필드 값들이 변할 수 도 있음을 의미함</li>
  <li>η 라는 실수 유형의 변수: learning rate 설정</li>
  <li>배치 사이즈, 반복횟수, 계산장비</li>
</ul>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@with_kw</span> <span class="k">mutable struct</span><span class="nc"> Args</span>
    <span class="n">η</span><span class="o">::</span><span class="kt">Float64</span> <span class="o">=</span> <span class="mf">3e-4</span>       <span class="c"># learning rate</span>
    <span class="n">batchsize</span><span class="o">::</span><span class="kt">Int</span> <span class="o">=</span> <span class="mi">1024</span>   <span class="c"># batch size</span>
    <span class="n">epochs</span><span class="o">::</span><span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span>        <span class="c"># number of epochs</span>
    <span class="n">device</span><span class="o">::</span><span class="kt">Function</span> <span class="o">=</span> <span class="n">gpu</span>  <span class="c"># set as gpu, if gpu available</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Args
</code></pre></div></div>

<h2 id="3-데이터-가져오기-및-전처리">[3] 데이터 가져오기 및 전처리</h2>
<ul>
  <li>[1] 손글씨 DB 가져오기</li>
  <li>[2] 정답레이블(y) 원핫벡터 만들기</li>
  <li>[3] 학습/테스트 데이터 분할하여 DataLoader안에 넣기</li>
</ul>

<p>모든 과정이 getdata함수에 포함</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#[1] 학습세트: 28x28x60000 실수 벡터 </span>
<span class="n">xtrain</span><span class="x">,</span> <span class="n">ytrain</span> <span class="o">=</span> <span class="n">MLDatasets</span><span class="o">.</span><span class="n">MNIST</span><span class="o">.</span><span class="n">traindata</span><span class="x">(</span><span class="kt">Float32</span><span class="x">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

...

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [5, 0, 4, 1, 9, 2, 1, 3, 1, 4  …  9, 2, 9, 5, 1, 8, 3, 5, 6, 8])
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [2]</span>
<span class="n">ytrain</span> <span class="o">=</span> <span class="n">onehotbatch</span><span class="x">(</span><span class="n">ytrain</span><span class="x">,</span> <span class="mi">0</span><span class="o">:</span><span class="mi">9</span><span class="x">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10×60000 Flux.OneHotMatrix{Array{Flux.OneHotVector,1}}:
 0  1  0  0  0  0  0  0  0  0  0  0  0  …  0  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  1  0  0  1  0  1  0  0  0  0     0  0  0  0  0  0  1  0  0  0  0  0
 0  0  0  0  0  1  0  0  0  0  0  0  0     0  0  0  1  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  1  0  0  1  0  1     0  0  0  0  0  0  0  0  1  0  0  0
 0  0  1  0  0  0  0  0  0  1  0  0  0     0  0  0  0  0  0  0  0  0  0  0  0
 1  0  0  0  0  0  0  0  0  0  0  1  0  …  0  0  0  0  0  1  0  0  0  1  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  0  0  0  0  0  0  0  0  0  1  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     1  0  0  0  0  0  0  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0     0  1  0  0  0  0  0  1  0  0  0  1
 0  0  0  0  1  0  0  0  0  0  0  0  0     0  0  1  0  1  0  0  0  0  0  0  0
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># [3]</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="x">()</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="x">(</span><span class="n">xtrain</span><span class="x">,</span> <span class="n">ytrain</span><span class="x">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batchsize</span><span class="x">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="nb">true</span><span class="x">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DataLoader((Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

...

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]

Float32[0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], Bool[0 1 … 0 0; 0 0 … 0 0; … ; 0 0 … 0 1; 0 0 … 0 0]), 1024, 60000, true, 60000, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10  …  59991, 59992, 59993, 59994, 59995, 59996, 59997, 59998, 59999, 60000], true)
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> getdata</span><span class="x">(</span><span class="n">args</span><span class="x">)</span>
    <span class="c"># Loading Dataset</span>
    <span class="n">xtrain</span><span class="x">,</span> <span class="n">ytrain</span> <span class="o">=</span> <span class="n">MLDatasets</span><span class="o">.</span><span class="n">MNIST</span><span class="o">.</span><span class="n">traindata</span><span class="x">(</span><span class="kt">Float32</span><span class="x">)</span>
    <span class="n">xtest</span><span class="x">,</span> <span class="n">ytest</span> <span class="o">=</span> <span class="n">MLDatasets</span><span class="o">.</span><span class="n">MNIST</span><span class="o">.</span><span class="n">testdata</span><span class="x">(</span><span class="kt">Float32</span><span class="x">)</span>

    <span class="c"># Reshape Data in order to flatten each image into a linear array</span>
    <span class="n">xtrain</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="n">flatten</span><span class="x">(</span><span class="n">xtrain</span><span class="x">)</span>
    <span class="n">xtest</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="n">flatten</span><span class="x">(</span><span class="n">xtest</span><span class="x">)</span>

    <span class="c"># One-hot-encode the labels</span>
    <span class="n">ytrain</span><span class="x">,</span> <span class="n">ytest</span> <span class="o">=</span> <span class="n">onehotbatch</span><span class="x">(</span><span class="n">ytrain</span><span class="x">,</span> <span class="mi">0</span><span class="o">:</span><span class="mi">9</span><span class="x">),</span> <span class="n">onehotbatch</span><span class="x">(</span><span class="n">ytest</span><span class="x">,</span> <span class="mi">0</span><span class="o">:</span><span class="mi">9</span><span class="x">)</span>

    <span class="c"># Batching</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="x">(</span><span class="n">xtrain</span><span class="x">,</span> <span class="n">ytrain</span><span class="x">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batchsize</span><span class="x">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="nb">true</span><span class="x">)</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="x">(</span><span class="n">xtest</span><span class="x">,</span> <span class="n">ytest</span><span class="x">,</span> <span class="n">batchsize</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">batchsize</span><span class="x">)</span>

    <span class="k">return</span> <span class="n">train_data</span><span class="x">,</span> <span class="n">test_data</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getdata (generic function with 1 method)
</code></pre></div></div>

<h2 id="4-모델-만들기layer쌓기">[4] 모델 만들기(layer쌓기)</h2>
<ul>
  <li>입력층: 28x28입력, 퍼셉트론 개수 32개, 활성함수 relu</li>
  <li>출력층: 입력 32, 출력 10<br />
참고자료: https://fluxml.ai/Flux.jl/stable/models/basics/#Building-Layers-1</li>
</ul>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> build_model</span><span class="x">(;</span> <span class="n">imgsize</span><span class="o">=</span><span class="x">(</span><span class="mi">28</span><span class="x">,</span><span class="mi">28</span><span class="x">,</span><span class="mi">1</span><span class="x">),</span> <span class="n">nclasses</span><span class="o">=</span><span class="mi">10</span><span class="x">)</span>
    <span class="k">return</span> <span class="n">Chain</span><span class="x">(</span>
        <span class="n">Dense</span><span class="x">(</span><span class="n">prod</span><span class="x">(</span><span class="n">imgsize</span><span class="x">),</span> <span class="mi">32</span><span class="x">,</span> <span class="n">relu</span><span class="x">),</span>
            <span class="n">Dense</span><span class="x">(</span><span class="mi">32</span><span class="x">,</span> <span class="n">nclasses</span><span class="x">))</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build_model (generic function with 1 method)
</code></pre></div></div>

<h2 id="5-손실-함수">[5] 손실 함수</h2>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># </span>
<span class="k">function</span><span class="nf"> loss_all</span><span class="x">(</span><span class="n">dataloader</span><span class="x">,</span> <span class="n">model</span><span class="x">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="mf">0f0</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">x</span><span class="x">,</span><span class="n">y</span><span class="x">)</span> <span class="k">in</span> <span class="n">dataloader</span>
        <span class="n">l</span> <span class="o">+=</span> <span class="n">logitcrossentropy</span><span class="x">(</span><span class="n">model</span><span class="x">(</span><span class="n">x</span><span class="x">),</span> <span class="n">y</span><span class="x">)</span>
    <span class="k">end</span>
    <span class="n">l</span><span class="o">/</span><span class="n">length</span><span class="x">(</span><span class="n">dataloader</span><span class="x">)</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>loss_all (generic function with 1 method)
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> accuracy</span><span class="x">(</span><span class="n">data_loader</span><span class="x">,</span> <span class="n">model</span><span class="x">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="x">(</span><span class="n">x</span><span class="x">,</span><span class="n">y</span><span class="x">)</span> <span class="k">in</span> <span class="n">data_loader</span>
        <span class="n">acc</span> <span class="o">+=</span> <span class="n">sum</span><span class="x">(</span><span class="n">onecold</span><span class="x">(</span><span class="n">cpu</span><span class="x">(</span><span class="n">model</span><span class="x">(</span><span class="n">x</span><span class="x">)))</span> <span class="o">.==</span> <span class="n">onecold</span><span class="x">(</span><span class="n">cpu</span><span class="x">(</span><span class="n">y</span><span class="x">)))</span><span class="o">*</span><span class="mi">1</span> <span class="o">/</span> <span class="n">size</span><span class="x">(</span><span class="n">x</span><span class="x">,</span><span class="mi">2</span><span class="x">)</span>
    <span class="k">end</span>
    <span class="n">acc</span><span class="o">/</span><span class="n">length</span><span class="x">(</span><span class="n">data_loader</span><span class="x">)</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accuracy (generic function with 1 method)
</code></pre></div></div>

<h2 id="multi-layer-perceptron-전체-학습">multi-layer perceptron 전체 학습</h2>

<ul>
  <li>wrapper @epochs 는 반복횟수를 지정해서 훈련함수를 실행하도록 한다.</li>
  <li>Flux.train 함수가 실제 훈련을 수행 필요 파라미터는 아래와 같다.
    <blockquote>
      <p>loss<br />
params<br />
train_data<br />
opt<br />
cb</p>
    </blockquote>
  </li>
</ul>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 훈련시키기</span>
<span class="k">function</span><span class="nf"> train</span><span class="x">(;</span> <span class="n">kws</span><span class="o">...</span><span class="x">)</span>
    <span class="c"># Initializing Model parameters </span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="x">(;</span> <span class="n">kws</span><span class="o">...</span><span class="x">)</span>

    <span class="c"># Load Data</span>
    <span class="n">train_data</span><span class="x">,</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">getdata</span><span class="x">(</span><span class="n">args</span><span class="x">)</span>

    <span class="c"># Construct model</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">build_model</span><span class="x">()</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="x">(</span><span class="n">train_data</span><span class="x">)</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="x">(</span><span class="n">test_data</span><span class="x">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="x">(</span><span class="n">m</span><span class="x">)</span>
    <span class="c"># 로스 함수.</span>
    <span class="n">loss</span><span class="x">(</span><span class="n">x</span><span class="x">,</span><span class="n">y</span><span class="x">)</span> <span class="o">=</span> <span class="n">logitcrossentropy</span><span class="x">(</span><span class="n">m</span><span class="x">(</span><span class="n">x</span><span class="x">),</span> <span class="n">y</span><span class="x">)</span>
    
    <span class="c">## Training</span>
    <span class="n">evalcb</span> <span class="o">=</span> <span class="x">()</span> <span class="o">-&gt;</span> <span class="nd">@show</span><span class="x">(</span><span class="n">loss_all</span><span class="x">(</span><span class="n">train_data</span><span class="x">,</span> <span class="n">m</span><span class="x">))</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">ADAM</span><span class="x">(</span><span class="n">args</span><span class="o">.</span><span class="n">η</span><span class="x">)</span>
    
    <span class="nd">@epochs</span> <span class="n">args</span><span class="o">.</span><span class="n">epochs</span> <span class="n">Flux</span><span class="o">.</span><span class="n">train!</span><span class="x">(</span><span class="n">loss</span><span class="x">,</span> <span class="n">params</span><span class="x">(</span><span class="n">m</span><span class="x">),</span> <span class="n">train_data</span><span class="x">,</span> <span class="n">opt</span><span class="x">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">evalcb</span><span class="x">)</span>

    <span class="nd">@show</span> <span class="n">accuracy</span><span class="x">(</span><span class="n">train_data</span><span class="x">,</span> <span class="n">m</span><span class="x">)</span>

    <span class="nd">@show</span> <span class="n">accuracy</span><span class="x">(</span><span class="n">test_data</span><span class="x">,</span> <span class="n">m</span><span class="x">)</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>train (generic function with 1 method)
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        




      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/mlp_tutorial_in_julia/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/mlp_tutorial_in_julia/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/mlp_tutorial_in_julia/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/mlp_tutorial_in_julia/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/julia_post/" class="pagination--pager" title="My julia post
">Previous</a>
    
    
      <a href="http://localhost:4000/Second/" class="pagination--pager" title="Little Talks on Symbols
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/Second/" rel="permalink">Little Talks on Symbols
</a>
      
    </h2>

<!--Uncomment out this section to have the read time re-included
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    
-->
        
         <p class="page__date"><!--<strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i>Published:</strong> --> <i><time datetime="2020-10-08T00:00:00-07:00">October 08, 2020</time></i></p>
        

    <!--The part below defines the "Read more" behavior-->
    <!--TODO: figure out how the excerpts are defined-->
    
    <p class="archive__item-excerpt" itemprop="description"><p>Ok, Let’s do it.
<strong><a href="http://localhost:4000/Second/" rel="permalink"> ... Read more</a></strong></p></p>
    

    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/julia_post/" rel="permalink">My julia post
</a>
      
    </h2>

<!--Uncomment out this section to have the read time re-included
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    
-->
        
         <p class="page__date"><!--<strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i>Published:</strong> --> <i><time datetime="2020-10-03T00:00:00-07:00">October 03, 2020</time></i></p>
        

    <!--The part below defines the "Read more" behavior-->
    <!--TODO: figure out how the excerpts are defined-->
    
    <p class="archive__item-excerpt" itemprop="description"><p>This is my julia post
<strong><a href="http://localhost:4000/julia_post/" rel="permalink"> ... Read more</a></strong></p></p>
    

    

  </article>
</div>

        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    

    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/First_post/" rel="permalink">My first post
</a>
      
    </h2>

<!--Uncomment out this section to have the read time re-included
    
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  
	  less than 1 minute read
	
</p>
    
-->
        
         <p class="page__date"><!--<strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i>Published:</strong> --> <i><time datetime="2020-10-03T00:00:00-07:00">October 03, 2020</time></i></p>
        

    <!--The part below defines the "Read more" behavior-->
    <!--TODO: figure out how the excerpts are defined-->
    
    <p class="archive__item-excerpt" itemprop="description"><p>This is my first post
<strong><a href="http://localhost:4000/First_post/" rel="permalink"> ... Read more</a></strong></p></p>
    

    

  </article>
</div>

        
      </div>
    </div>
  
</div>


    </script>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="/sitemap/">Sitemap</a>
<!-- end custom footer snippets -->

        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/2string.dh"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/dhjin"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 dhjin. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>






  </body>
</html>

